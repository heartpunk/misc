<html>                                                                            
   <head>                                                                         
      <meta charset="UTF-8">
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.js"></script>                        
      <style>
        .chart div {
          font: 10px sans-serif;
          background-color: steelblue;
          text-align: right;
          padding: 3px;
          margin: 1px;
          color: white;
        }
      </style>
   </head>                                                                        
   <body>                                                                         
      <div class="chart"></div>
      <script type="text/javascript">                                             
	var data = [
    	  {"name": "bananas", "awesomeness": 3},
    	  {"name": "apples", "awesomeness": 5},
    	  {"name": "kiwis", "awesomeness": 30},
    	  {"name": "pomegranates", "awesomeness": 42},
	];

	var x = d3.scale.linear()
          .domain([0, d3.max(data, function (el) {return el.awesomeness})])
          .range([0, 650]);

	chart = d3.select(".chart");
	divs = chart.selectAll("div");

	var selection = divs.data(data);

	function update(data) {
	  // just for convenience so we don't have to write this code twice.
	  function styler (d) {return x(d.awesomeness) + "px";}

          // warning! you MUST make a new selection for every update cycle.
          // i do not understand why yet, but this is the thing that seemed
          // to make it all work.

          var newSelection = chart.selectAll("div")
            .data(data, function (d) {return d.name});

	  // tell it what to do when things are removed.
	  newSelection.exit().remove();

	  // tell it what to do to new elements.
          newSelection.enter().append("div")
	        .attr("name", function (d) { return d.name })
                .style("width", styler)
                .text(function (d) { return d.name; });

          // the update selection is the default, so I don't specify update
          // here, but this is really what to do on updates.
	  newSelection.style("width", styler);

          // if you place any more enter selection based actions after the update,
          // then it will be applied to the update selection as well.
	}

	update(data);

	window.setTimeout(function () {
          truncatedData = data.slice(1,4);
	  update(truncatedData);
	}, 1500);

	window.setTimeout(function () {
          updatedData = data.slice(1,4);
          updatedData[2].awesomeness = 10;
	  update(updatedData);
	}, 4500);
      </script>                                                                   
   </body>                                                                        
</html>
